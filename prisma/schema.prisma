generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Chat {
  id        Int       @id @default(autoincrement())
  mensaje   String
  createdAt DateTime  @default(now())
  remitente Remitente
  idCliente Int
  cliente   Cliente   @relation(fields: [idCliente], references: [id])
}

model Cliente {
  id             Int          @id @default(autoincrement())
  nombre         String?
  apellido       String?
  telefono       String?
  email          String?
  direccion      String?
  whatsappNumber String       @unique
  profileName    String
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  Chat           Chat[]
  cotizacion     Cotizacion[]
}

model Cotizacion {
  id                Int                 @id @default(autoincrement())
  montoTotal        Float
  fechaCotizacion   DateTime
  idCliente         Int
  Cliente           Cliente             @relation(fields: [idCliente], references: [id])
  detalleCotizacion DetalleCotizacion[]
}

model ContratoServicios {
  id                       Int                        @id @default(autoincrement())
  montoTotal               Float
  descuento                Float
  fechaContrato            DateTime
  DetalleContratoServicios DetalleContratoServicios[]
}

model DetalleCotizacion {
  idCotizacion Int
  idProducto   Int
  cantidad     Int
  fechaEntrega DateTime
  Cotizacion   Cotizacion @relation(fields: [idCotizacion], references: [id])
  Producto     Producto   @relation(fields: [idProducto], references: [id])

  @@id([idCotizacion, idProducto])
}

model DetalleContratoServicios {
  idContratoServicios Int
  idProducto          Int
  cantidad            Int
  fechaIni            DateTime
  fechaFin            DateTime
  ContratoServicios   ContratoServicios @relation(fields: [idContratoServicios], references: [id])
  Producto            Producto          @relation(fields: [idProducto], references: [id])

  @@id([idContratoServicios, idProducto])
}

model Categoria {
  id                 Int                  @id @default(autoincrement())
  nombre             String
  descripcion        String
  Categoria_Producto Categoria_Producto[]
}

model Categoria_Producto {
  idCategoria Int
  idProducto  Int
  Categoria   Categoria @relation(fields: [idCategoria], references: [id])
  Producto    Producto  @relation(fields: [idProducto], references: [id])

  @@id([idCategoria, idProducto])
}

model UnidadDeMedida {
  id          Int        @id @default(autoincrement())
  nombre      String
  abreviatura String
  descripcion String
  Producto    Producto[]
}

model Producto {
  id                       Int                        @id @default(autoincrement())
  nombre                   String                     @unique
  descripcion              String?
  precio                   Float
  stock                    Int
  caracteristicas          Json
  idUnidadDeMedida         Int
  Categoria_Producto       Categoria_Producto[]
  DetalleContratoServicios DetalleContratoServicios[]
  DetalleCotizacion        DetalleCotizacion[]
  UnidadDeMedida           UnidadDeMedida             @relation(fields: [idUnidadDeMedida], references: [id])
}

enum Remitente {
  Cliente
  IA
}
